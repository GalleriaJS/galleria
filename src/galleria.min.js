/**
 * Galleria v 1.3.4 2014-01-08
 * http://galleria.io
 *
 * Licensed under the MIT license
 * https://raw.github.com/aino/galleria/master/LICENSE
 *
 */
(function(e,t,n,r){var i=t.document,s=e(i),o=e(t),u=Array.prototype,a=1.33,f=!0,l=3e4,c=!1,h=navigator.userAgent.toLowerCase(),p=t.location.hash.replace(/#\//,""),d=t.location.protocol,v=Math,m=function(){},g=function(){return!1},y=function(){var e=3,t=i.createElement("div"),n=t.getElementsByTagName("i");do t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->";while(n[0]);return e>4?e:i.documentMode||r}(),b=function(){return{html:i.documentElement,body:i.body,head:i.getElementsByTagName("head")[0],title:i.title}},w=t.parent!==t.self,E="data ready thumbnail loadstart loadfinish image play pause progress fullscreen_enter fullscreen_exit idle_enter idle_exit rescale lightbox_open lightbox_close lightbox_image",S=function(){var t=[];e.each(E.split(" "),function(e,n){t.push(n);/_/.test(n)&&t.push(n.replace(/_/g,""))});return t}(),x=function(t){var n;if(typeof t!="object")return t;e.each(t,function(r,i){if(/^[a-z]+_/.test(r)){n="";e.each(r.split("_"),function(e,t){n+=e>0?t.substr(0,1).toUpperCase()+t.substr(1):t});t[n]=i;delete t[r]}});return t},T=function(t){return e.inArray(t,S)>-1?n[t.toUpperCase()]:t},N={youtube:{reg:/https?:\/\/(?:[a-zA_Z]{2,3}.)?(?:youtube\.com\/watch\?)((?:[\w\d\-\_\=]+&amp;(?:amp;)?)*v(?:&lt;[A-Z]+&gt;)?=([0-9a-zA-Z\-\_]+))/i,embed:function(){return"http://www.youtube.com/embed/"+this.id},getUrl:function(){return d+"//gdata.youtube.com/feeds/api/videos/"+this.id+"?v=2&alt=json-in-script&callback=?"},get_thumb:function(e){return e.entry.media$group.media$thumbnail[2].url},get_image:function(e){return e.entry.yt$hd?d+"//img.youtube.com/vi/"+this.id+"/maxresdefault.jpg":e.entry.media$group.media$thumbnail[3].url}},vimeo:{reg:/https?:\/\/(?:www\.)?(vimeo\.com)\/(?:hd#)?([0-9]+)/i,embed:function(){return"http://player.vimeo.com/video/"+this.id},getUrl:function(){return d+"//vimeo.com/api/v2/video/"+this.id+".json?callback=?"},get_thumb:function(e){return e[0].thumbnail_medium},get_image:function(e){return e[0].thumbnail_large}},dailymotion:{reg:/https?:\/\/(?:www\.)?(dailymotion\.com)\/video\/([^_]+)/,embed:function(){return d+"//www.dailymotion.com/embed/video/"+this.id},getUrl:function(){return"https://api.dailymotion.com/video/"+this.id+"?fields=thumbnail_240_url,thumbnail_720_url&callback=?"},get_thumb:function(e){return e.thumbnail_240_url},get_image:function(e){return e.thumbnail_720_url}},_inst:[]},C=function(t,n){for(var r=0;r<N._inst.length;r++)if(N._inst[r].id===n&&N._inst[r].type==t)return N._inst[r];this.type=t;this.id=n;this.readys=[];N._inst.push(this);var i=this;e.extend(this,N[t]);e.getJSON(this.getUrl(),function(t){i.data=t;e.each(i.readys,function(e,t){t(i.data)});i.readys=[]});this.getMedia=function(e,t,n){n=n||m;var r=this,i=function(n){t(r["get_"+e](n))};try{r.data?i(r.data):r.readys.push(i)}catch(s){n()}}},k=function(e){var t;for(var n in N){t=e&&N[n].reg&&e.match(N[n].reg);if(t&&t.length)return{id:t[2],provider:n}}return!1},L={support:function(){var e=b().html;return!w&&(e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullScreen)}(),callback:m,enter:function(e,t,n){this.instance=e;this.callback=t||m;n=n||b().html;n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullScreen&&n.webkitRequestFullScreen()},exit:function(e){this.callback=e||m;i.exitFullscreen?i.exitFullscreen():i.mozCancelFullScreen?i.mozCancelFullScreen():i.webkitCancelFullScreen&&i.webkitCancelFullScreen()},instance:null,listen:function(){if(!this.support)return;var e=function(){if(!L.instance)return;var e=L.instance._fullscreen;i.fullscreen||i.mozFullScreen||i.webkitIsFullScreen?e._enter(L.callback):e._exit(L.callback)};i.addEventListener("fullscreenchange",e,!1);i.addEventListener("mozfullscreenchange",e,!1);i.addEventListener("webkitfullscreenchange",e,!1)}},A=[],O=[],M=!1,_=!1,D=[],P=function(t){n.theme=t;e.each(D,function(e,t){t._initialized||t._init.call(t)});D=[]},H=function(){return{clearTimer:function(t){e.each(n.get(),function(){this.clearTimer(t)})},addTimer:function(t){e.each(n.get(),function(){this.addTimer(t)})},array:function(e){return u.slice.call(e,0)},create:function(e,t){t=t||"div";var n=i.createElement(t);n.className=e;return n},removeFromArray:function(t,n){e.each(t,function(e,r){if(r==n){t.splice(e,1);return!1}});return t},getScriptPath:function(t){t=t||e("script:last").attr("src");var n=t.split("/");if(n.length==1)return"";n.pop();return n.join("/")+"/"},animate:function(){var r=function(e){var n="transition WebkitTransition MozTransition OTransition".split(" "),r;if(t.opera)return!1;for(r=0;n[r];r++)if(typeof e[n[r]]!="undefined")return n[r];return!1}((i.body||i.documentElement).style),s={MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[r],o={_default:[.25,.1,.25,1],galleria:[.645,.045,.355,1],galleriaIn:[.55,.085,.68,.53],galleriaOut:[.25,.46,.45,.94],ease:[.25,0,.25,1],linear:[.25,.25,.75,.75],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1]},u=function(t,n,r){var i={};r=r||"transition";e.each("webkit moz ms o".split(" "),function(){i["-"+this+"-"+r]=n});t.css(i)},a=function(e){u(e,"none","transition");if(n.WEBKIT&&n.TOUCH){u(e,"translate3d(0,0,0)","transform");if(e.data("revert")){e.css(e.data("revert"));e.data("revert",null)}}},f,l,c,h,p,d,v;return function(i,g,y){y=e.extend({duration:400,complete:m,stop:!1},y);i=e(i);if(!y.duration){i.css(g);y.complete.call(i[0]);return}if(!r){i.animate(g,y);return}if(y.stop){i.off(s);a(i)}f=!1;e.each(g,function(e,t){v=i.css(e);H.parseValue(v)!=H.parseValue(t)&&(f=!0);i.css(e,v)});if(!f){t.setTimeout(function(){y.complete.call(i[0])},y.duration);return}l=[];c=y.easing in o?o[y.easing]:o._default;h=" "+y.duration+"ms"+" cubic-bezier("+c.join(",")+")";t.setTimeout(function(t,r,i,s){return function(){t.one(r,function(e){return function(){a(e);y.complete.call(e[0])}}(t));if(n.WEBKIT&&n.TOUCH){p={};d=[0,0,0];e.each(["left","top"],function(e,n){if(n in i){d[e]=H.parseValue(i[n])-H.parseValue(t.css(n))+"px";p[n]=i[n];delete i[n]}});if(d[0]||d[1]){t.data("revert",p);l.push("-webkit-transform"+s);u(t,"translate3d("+d.join(",")+")","transform")}}e.each(i,function(e,t){l.push(e+s)});u(t,l.join(","));t.css(i)}}(i,s,g,h),2)}}(),removeAlpha:function(e){e instanceof jQuery&&(e=e[0]);if(y<9&&e){var t=e.style,n=e.currentStyle,r=n&&n.filter||t.filter||"";/alpha/.test(r)&&(t.filter=r.replace(/alpha\([^)]*\)/i,""))}},forceStyles:function(t,n){t=e(t);t.attr("style")&&t.data("styles",t.attr("style")).removeAttr("style");t.css(n)},revertStyles:function(){e.each(H.array(arguments),function(t,n){n=e(n);n.removeAttr("style");n.attr("style","");n.data("styles")&&n.attr("style",n.data("styles")).data("styles",null)})},moveOut:function(e){H.forceStyles(e,{position:"absolute",left:-1e4})},moveIn:function(){H.revertStyles.apply(H,H.array(arguments))},hide:function(t,n,r){r=r||m;var i=e(t);t=i[0];i.data("opacity")||i.data("opacity",i.css("opacity"));var s={opacity:0};if(n){var o=y<9&&t?function(){H.removeAlpha(t);t.style.visibility="hidden";r.call(t)}:r;H.animate(t,s,{duration:n,complete:o,stop:!0})}else if(y<9&&t){H.removeAlpha(t);t.style.visibility="hidden"}else i.css(s)},show:function(t,n,r){r=r||m;var i=e(t);t=i[0];var s=parseFloat(i.data("opacity"))||1,o={opacity:s};if(n){if(y<9){i.css("opacity",0);t.style.visibility="visible"}var u=y<9&&t?function(){o.opacity==1&&H.removeAlpha(t);r.call(t)}:r;H.animate(t,o,{duration:n,complete:u,stop:!0})}else if(y<9&&o.opacity==1&&t){H.removeAlpha(t);t.style.visibility="visible"}else i.css(o)},wait:function(r){n._waiters=n._waiters||[];r=e.extend({until:g,success:m,error:function(){n.raise("Could not complete wait function.")},timeout:3e3},r);var i=H.timestamp(),s,o,u,a=function(){o=H.timestamp();s=o-i;H.removeFromArray(n._waiters,u);if(r.until(s)){r.success();return!1}if(typeof r.timeout=="number"&&o>=i+r.timeout){r.error();return!1}n._waiters.push(u=t.setTimeout(a,10))};n._waiters.push(u=t.setTimeout(a,10))},toggleQuality:function(e,t){if(y!==7&&y!==8||!e||e.nodeName.toUpperCase()!="IMG")return;typeof t=="undefined"&&(t=e.style.msInterpolationMode==="nearest-neighbor");e.style.msInterpolationMode=t?"bicubic":"nearest-neighbor"},insertStyleTag:function(t,n){if(n&&e("#"+n).length)return;var r=i.createElement("style");n&&(r.id=n);b().head.appendChild(r);if(r.styleSheet)r.styleSheet.cssText=t;else{var s=i.createTextNode(t);r.appendChild(s)}},loadScript:function(t,n){var r=!1,i=e("<script>").attr({src:t,async:!0}).get(0);i.onload=i.onreadystatechange=function(){if(!r&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){r=!0;i.onload=i.onreadystatechange=null;typeof n=="function"&&n.call(this,this)}};b().head.appendChild(i)},parseValue:function(e){if(typeof e=="number")return e;if(typeof e=="string"){var t=e.match(/\-?\d|\./g);return t&&t.constructor===Array?t.join("")*1:0}return 0},timestamp:function(){return(new Date).getTime()},loadCSS:function(t,s,o){var u,a;e("link[rel=stylesheet]").each(function(){if((new RegExp(t)).test(this.href)){u=this;return!1}});if(typeof s=="function"){o=s;s=r}o=o||m;if(u){o.call(u,u);return u}a=i.styleSheets.length;if(e("#"+s).length){e("#"+s).attr("href",t);a--}else{u=e("<link>").attr({rel:"stylesheet",href:t,id:s}).get(0);var f=e('link[rel="stylesheet"], style');f.length?f.get(0).parentNode.insertBefore(u,f[0]):b().head.appendChild(u);if(y&&a>=31){n.raise("You have reached the browser stylesheet limit (31)",!0);return}}if(typeof o=="function"){var l=e("<s>").attr("id","galleria-loader").hide().appendTo(b().body);H.wait({until:function(){return l.height()==1},success:function(){l.remove();o.call(u,u)},error:function(){l.remove();n.raise("Theme CSS could not load after 20 sec. "+(n.QUIRK?"Your browser is in Quirks Mode, please add a correct doctype.":"Please download the latest theme at http://galleria.io/customer/."),!0)},timeout:5e3})}return u}}}(),B=function(t){var n=".galleria-videoicon{width:60px;height:60px;position:absolute;top:50%;left:50%;z-index:1;margin:-30px 0 0 -30px;cursor:pointer;background:#000;background:rgba(0,0,0,.8);border-radius:3px;-webkit-transition:all 150ms}.galleria-videoicon i{width:0px;height:0px;border-style:solid;border-width:10px 0 10px 16px;display:block;border-color:transparent transparent transparent #ffffff;margin:20px 0 0 22px}.galleria-image:hover .galleria-videoicon{background:#000}";H.insertStyleTag(n,"galleria-videoicon");return e(H.create("galleria-videoicon")).html("<i></i>").appendTo(t).click(function(){e(this).siblings("img").mouseup()})},j=function(){var t=function(t,n,r,i){var s=this.getOptions("easing"),o=this.getStageWidth(),u={left:o*(t.rewind?-1:1)},a={left:0};if(r){u.opacity=0;a.opacity=1}else u.opacity=1;e(t.next).css(u);H.animate(t.next,a,{duration:t.speed,complete:function(e){return function(){n();e.css({left:0})}}(e(t.next).add(t.prev)),queue:!1,easing:s});i&&(t.rewind=!t.rewind);if(t.prev){u={left:0};a={left:o*(t.rewind?1:-1)};if(r){u.opacity=1;a.opacity=0}e(t.prev).css(u);H.animate(t.prev,a,{duration:t.speed,queue:!1,easing:s,complete:function(){e(this).css("opacity",0)}})}};return{active:!1,init:function(e,t,n){j.effects.hasOwnProperty(e)&&j.effects[e].call(this,t,n)},effects:{fade:function(t,n){e(t.next).css({opacity:0,left:0});H.animate(t.next,{opacity:1},{duration:t.speed,complete:n});if(t.prev){e(t.prev).css("opacity",1).show();H.animate(t.prev,{opacity:0},{duration:t.speed})}},flash:function(t,n){e(t.next).css({opacity:0,left:0});t.prev?H.animate(t.prev,{opacity:0},{duration:t.speed/2,complete:function(){H.animate(t.next,{opacity:1},{duration:t.speed,complete:n})}}):H.animate(t.next,{opacity:1},{duration:t.speed,complete:n})},pulse:function(t,n){t.prev&&e(t.prev).hide();e(t.next).css({opacity:0,left:0}).show();H.animate(t.next,{opacity:1},{duration:t.speed,complete:n})},slide:function(e,n){t.apply(this,H.array(arguments))},fadeslide:function(e,n){t.apply(this,H.array(arguments).concat([!0]))},doorslide:function(e,n){t.apply(this,H.array(arguments).concat([!1,!0]))}}}}();L.listen();e.event.special["click:fast"]={propagate:!0,add:function(t){var r=this.propagate;n.TOUCH?e(this).on("touchstart.fast",function(r){var i=r.originalEvent,s,o,u=0;if(i.touches.length==1){s=i.touches[0].pageX;o=i.touches[0].pageY;e(this).on("touchmove.fast",function(e){var t=e.originalEvent.touches;t.length==1&&(u=v.max(v.abs(s-t[0].pageX),v.abs(o-t[0].pageY)))});e(this).on("touchend.fast",function(){if(u>4)return e(this).off("touchend.fast touchmove.fast");t.handler.call(this,r);e(this).off("touchend.fast touchmove.fast")})}}):e(this).on("click.fast",t.handler)},remove:function(t){n.TOUCH?e(this).off("touchstart.fast touchmove.fast touchend.fast"):e(this).off("click.fast",t.handler)}};o.on("orientationchange",function(){e(this).resize()});n=function(){var u=this;this._options={};this._playing=!1;this._playtime=5e3;this._active=null;this._queue={length:0};this._data=[];this._dom={};this._thumbnails=[];this._layers=[];this._initialized=!1;this._firstrun=!1;this._stageWidth=0;this._stageHeight=0;this._target=r;this._binds=[];this._id=parseInt(v.random()*1e4,10);var a="container stage images image-nav image-nav-left image-nav-right info info-text info-title info-description thumbnails thumbnails-list thumbnails-container thumb-nav-left thumb-nav-right loader counter tooltip",f="current total";e.each(a.split(" "),function(e,t){u._dom[t]=H.create("galleria-"+t)});e.each(f.split(" "),function(e,t){u._dom[t]=H.create("galleria-"+t,"span")});var l=this._keyboard={keys:{UP:38,DOWN:40,LEFT:37,RIGHT:39,RETURN:13,ESCAPE:27,BACKSPACE:8,SPACE:32},map:{},bound:!1,press:function(e){var t=e.keyCode||e.which;t in l.map&&typeof l.map[t]=="function"&&l.map[t].call(u,e)},attach:function(e){var t,n;for(t in e)if(e.hasOwnProperty(t)){n=t.toUpperCase();n in l.keys?l.map[l.keys[n]]=e[t]:l.map[n]=e[t]}if(!l.bound){l.bound=!0;s.on("keydown",l.press)}},detach:function(){l.bound=!1;l.map={};s.off("keydown",l.press)}},c=this._controls={0:r,1:r,active:0,swap:function(){c.active=c.active?0:1},getActive:function(){return u._options.swipe?c.slides[u._active]:c[c.active]},getNext:function(){return u._options.swipe?c.slides[u.getNext(u._active)]:c[1-c.active]},slides:[],frames:[],layers:[]},p=this._carousel={next:u.$("thumb-nav-right"),prev:u.$("thumb-nav-left"),width:0,current:0,max:0,hooks:[],update:function(){var t=0,n=0,r=[0];e.each(u._thumbnails,function(i,s){if(s.ready){t+=s.outerWidth||e(s.container).outerWidth(!0);var o=e(s.container).width();t+=o-v.floor(o);r[i+1]=t;n=v.max(n,s.outerHeight||e(s.container).outerHeight(!0))}});u.$("thumbnails").css({width:t,height:n});p.max=t;p.hooks=r;p.width=u.$("thumbnails-list").width();p.setClasses();u.$("thumbnails-container").toggleClass("galleria-carousel",t>p.width);p.width=u.$("thumbnails-list").width()},bindControls:function(){var e;p.next.on("click:fast",function(t){t.preventDefault();if(u._options.carouselSteps==="auto"){for(e=p.current;e<p.hooks.length;e++)if(p.hooks[e]-p.hooks[p.current]>p.width){p.set(e-2);break}}else p.set(p.current+u._options.carouselSteps)});p.prev.on("click:fast",function(t){t.preventDefault();if(u._options.carouselSteps==="auto")for(e=p.current;e>=0;e--){if(p.hooks[p.current]-p.hooks[e]>p.width){p.set(e+2);break}if(e===0){p.set(0);break}}else p.set(p.current-u._options.carouselSteps)})},set:function(e){e=v.max(e,0);while(p.hooks[e-1]+p.width>=p.max&&e>=0)e--;p.current=e;p.animate()},getLast:function(e){return(e||p.current)-1},follow:function(e){if(e===0||e===p.hooks.length-2){p.set(e);return}var t=p.current;while(p.hooks[t]-p.hooks[p.current]<p.width&&t<=p.hooks.length)t++;e-1<p.current?p.set(e-1):e+2>t&&p.set(e-t+p.current+2)},setClasses:function(){p.prev.toggleClass("disabled",!p.current);p.next.toggleClass("disabled",p.hooks[p.current]+p.width>=p.max)},animate:function(t){p.setClasses();var n=p.hooks[p.current]*-1;if(isNaN(n))return;u.$("thumbnails").css("left",function(){return e(this).css("left")});H.animate(u.get("thumbnails"),{left:n},{duration:u._options.carouselSpeed,easing:u._options.easing,queue:!1})}},d=this._tooltip={initialized:!1,open:!1,timer:"tooltip"+u._id,swapTimer:"swap"+u._id,init:function(){d.initialized=!0;var e=".galleria-tooltip{padding:3px 8px;max-width:50%;background:#ffe;color:#000;z-index:3;position:absolute;font-size:11px;line-height:1.3;opacity:0;box-shadow:0 0 2px rgba(0,0,0,.4);-moz-box-shadow:0 0 2px rgba(0,0,0,.4);-webkit-box-shadow:0 0 2px rgba(0,0,0,.4);}";H.insertStyleTag(e,"galleria-tooltip");u.$("tooltip").css({opacity:.8,visibility:"visible",display:"none"})},move:function(e){var t=u.getMousePosition(e).x,n=u.getMousePosition(e).y,r=u.$("tooltip"),i=t,s=n,o=r.outerHeight(!0)+1,a=r.outerWidth(!0),f=o+15,l=u.$("container").width()-a-2,c=u.$("container").height()-o-2;if(!isNaN(i)&&!isNaN(s)){i+=10;s-=o+8;i=v.max(0,v.min(l,i));s=v.max(0,v.min(c,s));n<f&&(s=f);r.css({left:i,top:s})}},bind:function(t,r){if(n.TOUCH)return;d.initialized||d.init();var i=function(){u.$("container").off("mousemove",d.move);u.clearTimer(d.timer);u.$("tooltip").stop().animate({opacity:0},200,function(){u.$("tooltip").hide();u.addTimer(d.swapTimer,function(){d.open=!1},1e3)})},s=function(t,n){d.define(t,n);e(t).hover(function(){u.clearTimer(d.swapTimer);u.$("container").off("mousemove",d.move).on("mousemove",d.move).trigger("mousemove");d.show(t);u.addTimer(d.timer,function(){u.$("tooltip").stop().show().animate({opacity:1});d.open=!0},d.open?0:500)},i).click(i)};typeof r=="string"?s(t in u._dom?u.get(t):t,r):e.each(t,function(e,t){s(u.get(e),t)})},show:function(n){n=e(n in u._dom?u.get(n):n);var r=n.data("tt"),i=function(e){t.setTimeout(function(e){return function(){d.move(e)}}(e),10);n.off("mouseup",i)};r=typeof r=="function"?r():r;if(!r)return;u.$("tooltip").html(r.replace(/\s/,"&#160;"));n.on("mouseup",i)},define:function(t,n){if(typeof n!="function"){var r=n;n=function(){return r}}t=e(t in u._dom?u.get(t):t).data("tt",n);d.show(t)}},m=this._fullscreen={scrolled:0,crop:r,active:!1,prev:e(),beforeEnter:function(e){e()},beforeExit:function(e){e()},keymap:u._keyboard.map,parseCallback:function(t,n){return j.active?function(){typeof t=="function"&&t.call(u);var r=u._controls.getActive(),i=u._controls.getNext();u._scaleImage(i);u._scaleImage(r);n&&u._options.trueFullscreen&&e(r.container).add(i.container).trigger("transitionend")}:t},enter:function(e){m.beforeEnter(function(){e=m.parseCallback(e,!0);if(u._options.trueFullscreen&&L.support){m.active=!0;H.forceStyles(u.get("container"),{width:"100%",height:"100%"});u.rescale();if(n.MAC)if(!n.SAFARI||!/version\/[1-5]/.test(h)){u.$("container").css("opacity",0).addClass("fullscreen");t.setTimeout(function(){m.scale();u.$("container").css("opacity",1)},50)}else{u.$("stage").css("opacity",0);t.setTimeout(function(){m.scale();u.$("stage").css("opacity",1)},4)}else u.$("container").addClass("fullscreen");o.resize(m.scale);L.enter(u,e,u.get("container"))}else{m.scrolled=o.scrollTop();n.TOUCH||t.scrollTo(0,0);m._enter(e)}})},_enter:function(s){m.active=!0;w&&(m.iframe=function(){var r,s=i.referrer,o=i.createElement("a"),u=t.location;o.href=s;if(o.protocol!=u.protocol||o.hostname!=u.hostname||o.port!=u.port){n.raise("Parent fullscreen not available. Iframe protocol, domains and ports must match.");return!1}m.pd=t.parent.document;e(m.pd).find("iframe").each(function(){var e=this.contentDocument||this.contentWindow.document;if(e===i){r=this;return!1}});return r}());H.hide(u.getActiveImage());if(w&&m.iframe){m.iframe.scrolled=e(t.parent).scrollTop();t.parent.scrollTo(0,0)}var a=u.getData(),f=u._options,l=!u._options.trueFullscreen||!L.support,c={height:"100%",overflow:"hidden",margin:0,padding:0};if(l){u.$("container").addClass("fullscreen");m.prev=u.$("container").prev();m.prev.length||(m.parent=u.$("container").parent());u.$("container").appendTo("body");H.forceStyles(u.get("container"),{position:n.TOUCH?"absolute":"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:1e4});H.forceStyles(b().html,c);H.forceStyles(b().body,c)}if(w&&m.iframe){H.forceStyles(m.pd.documentElement,c);H.forceStyles(m.pd.body,c);H.forceStyles(m.iframe,e.extend(c,{width:"100%",height:"100%",top:0,left:0,position:"fixed",zIndex:1e4,border:"none"}))}m.keymap=e.extend({},u._keyboard.map);u.attachKeyboard({escape:u.exitFullscreen,right:u.next,left:u.prev});m.crop=f.imageCrop;f.fullscreenCrop!=r&&(f.imageCrop=f.fullscreenCrop);if(a&&a.big&&a.image!==a.big){var h=new n.Picture,p=h.isCached(a.big),d=u.getIndex(),v=u._thumbnails[d];u.trigger({type:n.LOADSTART,cached:p,rewind:!1,index:d,imageTarget:u.getActiveImage(),thumbTarget:v,galleriaData:a});h.load(a.big,function(t){u._scaleImage(t,{complete:function(t){u.trigger({type:n.LOADFINISH,cached:p,index:d,rewind:!1,imageTarget:t.image,thumbTarget:v});var r=u._controls.getActive().image;r&&e(r).width(t.image.width).height(t.image.height).attr("style",e(t.image).attr("style")).attr("src",t.image.src)}})});var g=u.getNext(d),y=new n.Picture,E=u.getData(g);y.preload(u.isFullscreen()&&E.big?E.big:E.image)}u.rescale(function(){u.addTimer(!1,function(){l&&H.show(u.getActiveImage());typeof s=="function"&&s.call(u);u.rescale()},100);u.trigger(n.FULLSCREEN_ENTER)});l?o.resize(m.scale):H.show(u.getActiveImage())},scale:function(){u.rescale()},exit:function(e){m.beforeExit(function(){e=m.parseCallback(e);u._options.trueFullscreen&&L.support?L.exit(e):m._exit(e)})},_exit:function(e){m.active=!1;var r=!u._options.trueFullscreen||!L.support,i=u.$("container").removeClass("fullscreen");m.parent?m.parent.prepend(i):i.insertAfter(m.prev);if(r){H.hide(u.getActiveImage());H.revertStyles(u.get("container"),b().html,b().body);n.TOUCH||t.scrollTo(0,m.scrolled);var s=u._controls.frames[u._controls.active];s&&s.image&&(s.image.src=s.image.src)}if(w&&m.iframe){H.revertStyles(m.pd.documentElement,m.pd.body,m.iframe);m.iframe.scrolled&&t.parent.scrollTo(0,m.iframe.scrolled)}u.detachKeyboard();u.attachKeyboard(m.keymap);u._options.imageCrop=m.crop;var a=u.getData().big,f=u._controls.getActive().image;!u.getData().iframe&&f&&a&&a==f.src&&t.setTimeout(function(e){return function(){f.src=e}}(u.getData().image),1);u.rescale(function(){u.addTimer(!1,function(){r&&H.show(u.getActiveImage());typeof e=="function"&&e.call(u);o.trigger("resize")},50);u.trigger(n.FULLSCREEN_EXIT)});o.off("resize",m.scale)}},g=this._idle={trunk:[],bound:!1,active:!1,add:function(t,r,i,s){if(!t||n.TOUCH)return;g.bound||g.addEvent();t=e(t);if(typeof i=="boolean"){s=i;i={}}i=i||{};var o={},u;for(u in r)r.hasOwnProperty(u)&&(o[u]=t.css(u));t.data("idle",{from:e.extend(o,i),to:r,complete:!0,busy:!1});s?t.css(r):g.addTimer();g.trunk.push(t)},remove:function(t){t=e(t);e.each(g.trunk,function(e,n){if(n&&n.length&&!n.not(t).length){t.css(t.data("idle").from);g.trunk.splice(e,1)}});if(!g.trunk.length){g.removeEvent();u.clearTimer(g.timer)}},addEvent:function(){g.bound=!0;u.$("container").on("mousemove click",g.showAll);u._options.idleMode=="hover"&&u.$("container").on("mouseleave",g.hide)},removeEvent:function(){g.bound=!1;u.$("container").on("mousemove click",g.showAll);u._options.idleMode=="hover"&&u.$("container").off("mouseleave",g.hide)},addTimer:function(){if(u._options.idleMode=="hover")return;u.addTimer("idle",function(){g.hide()},u._options.idleTime)},hide:function(){if(!u._options.idleMode||u.getIndex()===!1)return;u.trigger(n.IDLE_ENTER);var t=g.trunk.length;e.each(g.trunk,function(e,n){var r=n.data("idle");if(!r)return;n.data("idle").complete=!1;H.animate(n,r.to,{duration:u._options.idleSpeed,complete:function(){e==t-1&&(g.active=!1)}})})},showAll:function(){u.clearTimer("idle");e.each(g.trunk,function(e,t){g.show(t)})},show:function(t){var r=t.data("idle");if(!g.active||!r.busy&&!r.complete){r.busy=!0;u.trigger(n.IDLE_EXIT);u.clearTimer("idle");H.animate(t,r.from,{duration:u._options.idleSpeed/2,complete:function(){g.active=!0;e(t).data("idle").busy=!1;e(t).data("idle").complete=!0}})}g.addTimer()}},E=this._lightbox={width:0,height:0,initialized:!1,active:null,image:null,elems:{},keymap:!1,init:function(){if(E.initialized)return;E.initialized=!0;var t="overlay box content shadow title info close prevholder prev nextholder next counter image",r={},i=u._options,s="",o="position:absolute;",a="lightbox-",f={overlay:"position:fixed;display:none;opacity:"+i.overlayOpacity+";filter:alpha(opacity="+i.overlayOpacity*100+");top:0;left:0;width:100%;height:100%;background:"+i.overlayBackground+";z-index:99990",box:"position:fixed;display:none;width:400px;height:400px;top:50%;left:50%;margin-top:-200px;margin-left:-200px;z-index:99991",shadow:o+"background:#000;width:100%;height:100%;",content:o+"background-color:#fff;top:10px;left:10px;right:10px;bottom:10px;overflow:hidden",info:o+"bottom:10px;left:10px;right:10px;color:#444;font:11px/13px arial,sans-serif;height:13px",close:o+"top:10px;right:10px;height:20px;width:20px;background:#fff;text-align:center;cursor:pointer;color:#444;font:16px/22px arial,sans-serif;z-index:99999",image:o+"top:10px;left:10px;right:10px;bottom:30px;overflow:hidden;display:block;",prevholder:o+"width:50%;top:0;bottom:40px;cursor:pointer;",nextholder:o+"width:50%;top:0;bottom:40px;right:-1px;cursor:pointer;",prev:o+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;left:20px;display:none;text-align:center;color:#000;font:bold 16px/36px arial,sans-serif",next:o+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;right:20px;left:auto;display:none;font:bold 16px/36px arial,sans-serif;text-align:center;color:#000",title:"float:left",counter:"float:right;margin-left:8px;"},l=function(t){return t.hover(function(){e(this).css("color","#bbb")},function(){e(this).css("color","#444")})},c={},h="";y>7?h=y<9?"background:#000;filter:alpha(opacity=0);":"background:rgba(0,0,0,0);":h="z-index:99999";f.nextholder+=h;f.prevholder+=h;e.each(f,function(e,t){s+=".galleria-"+a+e+"{"+t+"}"});s+=".galleria-"+a+"box.iframe .galleria-"+a+"prevholder,"+".galleria-"+a+"box.iframe .galleria-"+a+"nextholder{"+"width:100px;height:100px;top:50%;margin-top:-70px}";H.insertStyleTag(s,"galleria-lightbox");e.each(t.split(" "),function(e,t){u.addElement("lightbox-"+t);r[t]=E.elems[t]=u.get("lightbox-"+t)});E.image=new n.Picture;e.each({box:"shadow content close prevholder nextholder",info:"title counter",content:"info image",prevholder:"prev",nextholder:"next"},function(t,n){var r=[];e.each(n.split(" "),function(e,t){r.push(a+t)});c[a+t]=r});u.append(c);e(r.image).append(E.image.container);e(b().body).append(r.overlay,r.box);l(e(r.close).on("click:fast",E.hide).html("&#215;"));e.each(["Prev","Next"],function(t,i){var s=e(r[i.toLowerCase()]).html(/v/.test(i)?"&#8249;&#160;":"&#160;&#8250;"),o=e(r[i.toLowerCase()+"holder"]);o.on("click:fast",function(){E["show"+i]()});if(y<8||n.TOUCH){s.show();return}o.hover(function(){s.show()},function(e){s.stop().fadeOut(200)})});e(r.overlay).on("click:fast",E.hide);n.IPAD&&(u._options.lightboxTransitionSpeed=0)},rescale:function(t){var r=v.min(o.width()-40,E.width),i=v.min(o.height()-60,E.height),s=v.min(r/E.width,i/E.height),a=v.round(E.width*s)+40,f=v.round(E.height*s)+60,l={width:a,height:f,"margin-top":v.ceil(f/2)*-1,"margin-left":v.ceil(a/2)*-1};t?e(E.elems.box).css(l):e(E.elems.box).animate(l,{duration:u._options.lightboxTransitionSpeed,easing:u._options.easing,complete:function(){var t=E.image,r=u._options.lightboxFadeSpeed;u.trigger({type:n.LIGHTBOX_IMAGE,imageTarget:t.image});e(t.container).show();e(t.image).animate({opacity:1},r);H.show(E.elems.info,r)}})},hide:function(){E.image.image=null;o.off("resize",E.rescale);e(E.elems.box).hide().find("iframe").remove();H.hide(E.elems.info);u.detachKeyboard();u.attachKeyboard(E.keymap);E.keymap=!1;H.hide(E.elems.overlay,200,function(){e(this).hide().css("opacity",u._options.overlayOpacity);u.trigger(n.LIGHTBOX_CLOSE)})},showNext:function(){E.show(u.getNext(E.active))},showPrev:function(){E.show(u.getPrev(E.active))},show:function(r){E.active=r=typeof r=="number"?r:u.getIndex()||0;E.initialized||E.init();u.trigger(n.LIGHTBOX_OPEN);if(!E.keymap){E.keymap=e.extend({},u._keyboard.map);u.attachKeyboard({escape:E.hide,right:E.showNext,left:E.showPrev})}o.off("resize",E.rescale);var i=u.getData(r),s=u.getDataLength(),a=u.getNext(r),f,l,c;H.hide(E.elems.info);try{for(c=u._options.preload;c>0;c--){l=new n.Picture;f=u.getData(a);l.preload(f.big?f.big:f.image);a=u.getNext(a)}}catch(h){}E.image.isIframe=i.iframe&&!i.image;e(E.elems.box).toggleClass("iframe",E.image.isIframe);e(E.image.container).find(".galleria-videoicon").remove();E.image.load(i.big||i.image||i.iframe,function(n){if(n.isIframe){var a=e(t).width(),f=e(t).height();if(n.video&&u._options.maxVideoSize){var l=v.min(u._options.maxVideoSize/a,u._options.maxVideoSize/f);if(l<1){a*=l;f*=l}}E.width=a;E.height=f}else{E.width=n.original.width;E.height=n.original.height}e(n.image).css({width:n.isIframe?"100%":"100.1%",height:n.isIframe?"100%":"100.1%",top:0,bottom:0,zIndex:99998,opacity:0,visibility:"visible"}).parent().height("100%");E.elems.title.innerHTML=i.title||"";E.elems.counter.innerHTML=r+1+" / "+s;o.resize(E.rescale);E.rescale();if(i.image&&i.iframe){e(E.elems.box).addClass("iframe");if(i.video){var c=B(n.container).hide();t.setTimeout(function(){c.fadeIn(200)},200)}e(n.image).css("cursor","pointer").mouseup(function(t,n){return function(r){e(E.image.container).find(".galleria-videoicon").remove();r.preventDefault();n.isIframe=!0;n.load(t.iframe+(t.video?"&autoplay=1":""),{width:"100%",height:y<8?e(E.image.container).height():"100%"})}}(i,n))}});e(E.elems.overlay).show().css("visibility","visible");e(E.elems.box).show()}},S=this._timer={trunk:{},add:function(e,n,r,i){e=e||(new Date).getTime();i=i||!1;this.clear(e);if(i){var s=n;n=function(){s();S.add(e,n,r)}}this.trunk[e]=t.setTimeout(n,r)},clear:function(e){var n=function(e){t.clearTimeout(this.trunk[e]);delete this.trunk[e]},r;if(!!e&&e in this.trunk)n.call(this,e);else if(typeof e=="undefined")for(r in this.trunk)this.trunk.hasOwnProperty(r)&&n.call(this,r)}};return this};n.prototype={constructor:n,init:function(t,i){i=x(i);this._original={target:t,options:i,data:null};this._target=this._dom.target=t.nodeName?t:e(t).get(0);this._original.html=this._target.innerHTML;O.push(this);if(!this._target){n.raise("Target not found",!0);return}this._options={autoplay:!1,carousel:!0,carouselFollow:!0,carouselSpeed:400,carouselSteps:"auto",clicknext:!1,dailymotion:{foreground:"%23EEEEEE",highlight:"%235BCEC5",background:"%23222222",logo:0,hideInfos:1},dataConfig:function(e){return{}},dataSelector:"img",dataSort:!1,dataSource:this._target,debug:r,dummy:r,easing:"galleria",extend:function(e){},fullscreenCrop:r,fullscreenDoubleTap:!0,fullscreenTransition:r,height:0,idleMode:!0,idleTime:3e3,idleSpeed:200,imageCrop:!1,imageMargin:0,imagePan:!1,imagePanSmoothness:12,imagePosition:"50%",imageTimeout:r,initialTransition:r,keepSource:!1,layerFollow:!0,lightbox:!1,lightboxFadeSpeed:200,lightboxTransitionSpeed:200,linkSourceImages:!0,maxScaleRatio:r,maxVideoSize:r,minScaleRatio:r,overlayOpacity:.85,overlayBackground:"#0b0b0b",pauseOnInteraction:!0,popupLinks:!1,preload:2,queue:!0,responsive:!0,show:0,showInfo:!0,showCounter:!0,showImagenav:!0,swipe:!0,thumbCrop:!0,thumbEventType:"click:fast",thumbMargin:0,thumbQuality:"auto",thumbDisplayOrder:!0,thumbPosition:"50%",thumbnails:!0,touchTransition:r,transition:"fade",transitionInitial:r,transitionSpeed:400,trueFullscreen:!0,useCanvas:!1,variation:"",videoPoster:!0,vimeo:{title:0,byline:0,portrait:0,color:"aaaaaa"},wait:5e3,width:"auto",youtube:{modestbranding:1,autohide:1,color:"white",hd:1,rel:0,showinfo:0}};this._options.initialTransition=this._options.initialTransition||this._options.transitionInitial;i&&i.debug===!1&&(f=!1);i&&typeof i.imageTimeout=="number"&&(l=i.imageTimeout);i&&typeof i.dummy=="string"&&(c=i.dummy);n.TOUCH||(this._options.swipe=!1);e(this._target).children().hide();n.QUIRK&&n.raise("Your page is in Quirks mode, Galleria may not render correctly. Please validate your HTML and add a correct doctype.");typeof n.theme=="object"?this._init():D.push(this);return this},_init:function(){var s=this,u=this._options;if(this._initialized){n.raise("Init failed: Gallery instance already initialized.");return this}this._initialized=!0;if(!n.theme){n.raise("Init failed: No theme found.",!0);return this}e.extend(!0,u,n.theme.defaults,this._original.options,n.configure.options);if(u.swipe){u.clicknext=!1;u.imagePan=!1}(function(e){if(!("getContext"in e)){e=null;return}_=_||{elem:e,context:e.getContext("2d"),cache:{},length:0}})(i.createElement("canvas"));this.bind(n.DATA,function(
){t.screen&&t.screen.width&&Array.prototype.forEach&&this._data.forEach(function(e){var n="devicePixelRatio"in t?t.devicePixelRatio:1,r=v.max(t.screen.width,t.screen.height);r*n<1024&&(e.big=e.image)});this._original.data=this._data;this.get("total").innerHTML=this.getDataLength();var e=this.$("container");s._options.height<2&&(s._userRatio=s._ratio=s._options.height);var r={width:0,height:0},i=function(){return s.$("stage").height()};H.wait({until:function(){r=s._getWH();e.width(r.width).height(r.height);return i()&&r.width&&r.height>50},success:function(){s._width=r.width;s._height=r.height;s._ratio=s._ratio||r.height/r.width;n.WEBKIT?t.setTimeout(function(){s._run()},1):s._run()},error:function(){i()?n.raise("Could not extract sufficient width/height of the gallery container. Traced measures: width:"+r.width+"px, height: "+r.height+"px.",!0):n.raise("Could not extract a stage height from the CSS. Traced height: "+i()+"px.",!0)},timeout:typeof this._options.wait=="number"?this._options.wait:!1})});this.append({"info-text":["info-title","info-description"],info:["info-text"],"image-nav":["image-nav-right","image-nav-left"],stage:["images","loader","counter","image-nav"],"thumbnails-list":["thumbnails"],"thumbnails-container":["thumb-nav-left","thumbnails-list","thumb-nav-right"],container:["stage","thumbnails-container","info","tooltip"]});H.hide(this.$("counter").append(this.get("current"),i.createTextNode(" / "),this.get("total")));this.setCounter("&#8211;");H.hide(s.get("tooltip"));this.$("container").addClass((n.TOUCH?"touch":"notouch")+" "+this._options.variation);this._options.swipe||e.each(new Array(2),function(t){var r=new n.Picture;e(r.container).css({position:"absolute",top:0,left:0}).prepend(s._layers[t]=e(H.create("galleria-layer")).css({position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:2})[0]);s.$("images").append(r.container);s._controls[t]=r;var i=new n.Picture;i.isIframe=!0;e(i.container).attr("class","galleria-frame").css({position:"absolute",top:0,left:0,zIndex:4,background:"#000",display:"none"}).appendTo(r.container);s._controls.frames[t]=i});this.$("images").css({position:"relative",top:0,left:0,width:"100%",height:"100%"});if(u.swipe){this.$("images").css({position:"absolute",top:0,left:0,width:0,height:"100%"});this.finger=new n.Finger(this.get("stage"),{onchange:function(e){s.setCounter(e).setInfo(e).pause();s.show(e)},oncomplete:function(t){var n=v.max(0,v.min(parseInt(t,10),s.getDataLength()-1)),r=s.getData(n);e(s._thumbnails[n].container).addClass("active").siblings(".active").removeClass("active");if(!r)return;s.$("images").find("iframe").remove();s.$("images").find(".galleria-frame").css("opacity",0).hide();s._options.carousel&&s._options.carouselFollow&&s._carousel.follow(n)}});this.bind(n.RESCALE,function(){this.finger.setup()});this.$("stage").on("click",function(n){var i=s.getData();if(!i)return;if(i.iframe){s.isPlaying()&&s.pause();var o=s._controls.frames[s._active],u=s._stageWidth,a=s._stageHeight;if(e(o.container).find("iframe").length)return;e(o.container).css({width:u,height:a,opacity:0}).show().animate({opacity:1},200);t.setTimeout(function(){o.load(i.iframe+(i.video?"&autoplay=1":""),{width:u,height:a},function(e){s.$("container").addClass("videoplay");e.scale({width:s._stageWidth,height:s._stageHeight,iframelimit:i.video?s._options.maxVideoSize:r})})},100);return}if(i.link){if(s._options.popupLinks)var f=t.open(i.link,"_blank");else t.location.href=i.link;return}});this.bind(n.IMAGE,function(t){s.setCounter(t.index);s.setInfo(t.index);var n=this.getNext(),r=this.getPrev(),i=[r,n];i.push(this.getNext(n),this.getPrev(r),s._controls.slides.length-1);var o=[];e.each(i,function(t,n){e.inArray(n,o)==-1&&o.push(n)});e.each(o,function(t,n){var r=s.getData(n),i=s._controls.slides[n],o=s.isFullscreen()&&r.big?r.big:r.image||r.iframe;r.iframe&&!r.image&&(i.isIframe=!0);i.ready||s._controls.slides[n].load(o,function(t){t.isIframe||e(t.image).css("visibility","hidden");s._scaleImage(t,{complete:function(t){t.isIframe||e(t.image).css({opacity:0,visibility:"visible"}).animate({opacity:1},200)}})})})})}this.$("thumbnails, thumbnails-list").css({overflow:"hidden",position:"relative"});this.$("image-nav-right, image-nav-left").on("click:fast",function(e){u.pauseOnInteraction&&s.pause();var t=/right/.test(this.className)?"next":"prev";s[t]()}).on("click",function(e){e.preventDefault();(u.clicknext||u.swipe)&&e.stopPropagation()});e.each(["info","counter","image-nav"],function(e,t){u["show"+t.substr(0,1).toUpperCase()+t.substr(1).replace(/-/,"")]===!1&&H.moveOut(s.get(t.toLowerCase()))});this.load();!u.keepSource&&!y&&(this._target.innerHTML="");this.get("errors")&&this.appendChild("target","errors");this.appendChild("target","container");if(u.carousel){var a=0,f=u.show;this.bind(n.THUMBNAIL,function(){this.updateCarousel();++a==this.getDataLength()&&typeof f=="number"&&f>0&&this._carousel.follow(f)})}u.responsive&&o.on("resize",function(){s.isFullscreen()||s.resize()});u.fullscreenDoubleTap&&this.$("stage").on("touchstart",function(){var e,t,n,r,i,o,u=function(e){return e.originalEvent.touches?e.originalEvent.touches[0]:e};s.$("stage").on("touchmove",function(){e=0});return function(a){if(/(-left|-right)/.test(a.target.className))return;o=H.timestamp();t=u(a).pageX;n=u(a).pageY;if(a.originalEvent.touches.length<2&&o-e<300&&t-r<20&&n-i<20){s.toggleFullscreen();a.preventDefault();return}e=o;r=t;i=n}}());e.each(n.on.binds,function(t,n){e.inArray(n.hash,s._binds)==-1&&s.bind(n.type,n.callback)});return this},addTimer:function(){this._timer.add.apply(this._timer,H.array(arguments));return this},clearTimer:function(){this._timer.clear.apply(this._timer,H.array(arguments));return this},_getWH:function(){var t=this.$("container"),n=this.$("target"),r=this,i={},s;e.each(["width","height"],function(e,o){if(r._options[o]&&typeof r._options[o]=="number")i[o]=r._options[o];else{s=[H.parseValue(t.css(o)),H.parseValue(n.css(o)),t[o](),n[o]()];r["_"+o]||s.splice(s.length,H.parseValue(t.css("min-"+o)),H.parseValue(n.css("min-"+o)));i[o]=v.max.apply(v,s)}});r._userRatio&&(i.height=i.width*r._userRatio);return i},_createThumbnails:function(r){this.get("total").innerHTML=this.getDataLength();var s,o,u,a,f=this,l=this._options,c=r?this._data.length-r.length:0,h=c,p=[],d=0,v=y<8?"http://upload.wikimedia.org/wikipedia/commons/c/c0/Blank.gif":"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw%3D%3D",m=function(){var e=f.$("thumbnails").find(".active");return e.length?e.find("img").attr("src"):!1}(),g=typeof l.thumbnails=="string"?l.thumbnails.toLowerCase():null,b=function(e){return i.defaultView&&i.defaultView.getComputedStyle?i.defaultView.getComputedStyle(o.container,null)[e]:a.css(e)},w=function(t,r,i){return function(){e(i).append(t);f.trigger({type:n.THUMBNAIL,thumbTarget:t,index:r,galleriaData:f.getData(r)})}},E=function(t){l.pauseOnInteraction&&f.pause();var n=e(t.currentTarget).data("index");f.getIndex()!==n&&f.show(n);t.preventDefault()},S=function(t,r){e(t.container).css("visibility","visible");f.trigger({type:n.THUMBNAIL,thumbTarget:t.image,index:t.data.order,galleriaData:f.getData(t.data.order)});typeof r=="function"&&r.call(f,t)},x=function(t,n){t.scale({width:t.data.width,height:t.data.height,crop:l.thumbCrop,margin:l.thumbMargin,canvas:l.useCanvas,position:l.thumbPosition,complete:function(t){var r=["left","top"],i=["Width","Height"],s,o,u=f.getData(t.index);e.each(i,function(n,i){s=i.toLowerCase();if(l.thumbCrop!==!0||l.thumbCrop===s){o={};o[s]=t[s];e(t.container).css(o);o={};o[r[n]]=0;e(t.image).css(o)}t["outer"+i]=e(t.container)["outer"+i](!0)});H.toggleQuality(t.image,l.thumbQuality===!0||l.thumbQuality==="auto"&&t.original.width<t.width*3);l.thumbDisplayOrder&&!t.lazy?e.each(p,function(e,t){if(e===d&&t.ready&&!t.displayed){d++;t.displayed=!0;S(t,n);return}}):S(t,n)}})};if(!r){this._thumbnails=[];this.$("thumbnails").empty()}for(;this._data[c];c++){u=this._data[c];s=u.thumb||u.image;if(l.thumbnails!==!0&&g!="lazy"||!u.thumb&&!u.image)if(u.iframe||g==="empty"||g==="numbers"){o={container:H.create("galleria-image"),image:H.create("img","span"),ready:!0,data:{order:c}};g==="numbers"&&e(o.image).text(c+1);u.iframe&&e(o.image).addClass("iframe");this.$("thumbnails").append(o.container);t.setTimeout(w(o.image,c,o.container),50+c*20)}else o={container:null,image:null};else{o=new n.Picture(c);o.index=c;o.displayed=!1;o.lazy=!1;o.video=!1;this.$("thumbnails").append(o.container);a=e(o.container);a.css("visibility","hidden");o.data={width:H.parseValue(b("width")),height:H.parseValue(b("height")),order:c,src:s};l.thumbCrop!==!0?a.css({width:"auto",height:"auto"}):a.css({width:o.data.width,height:o.data.height});if(g=="lazy"){a.addClass("lazy");o.lazy=!0;o.load(v,{height:o.data.height,width:o.data.width})}else o.load(s,x);l.preload==="all"&&o.preload(u.image)}e(o.container).add(l.keepSource&&l.linkSourceImages?u.original:null).data("index",c).on(l.thumbEventType,E).data("thumbload",x);m===s&&e(o.container).addClass("active");this._thumbnails.push(o)}p=this._thumbnails.slice(h);return this},lazyLoad:function(t,n){var r=t.constructor==Array?t:[t],i=this,s=0;e.each(r,function(t,o){if(o>i._thumbnails.length-1)return;var u=i._thumbnails[o],a=u.data,f=function(){++s==r.length&&typeof n=="function"&&n.call(i)},l=e(u.container).data("thumbload");u.video?l.call(i,u,f):u.load(a.src,function(e){l.call(i,e,f)})});return this},lazyLoadChunks:function(e,n){var r=this.getDataLength(),i=0,s=0,o=[],u=[],a=this;n=n||0;for(;i<r;i++){u.push(i);if(++s==e||i==r-1){o.push(u);s=0;u=[]}}var f=function(e){var r=o.shift();r&&t.setTimeout(function(){a.lazyLoad(r,function(){f(!0)})},n&&e?n:0)};f(!1);return this},_run:function(){var i=this;i._createThumbnails();H.wait({timeout:1e4,until:function(){n.OPERA&&i.$("stage").css("display","inline-block");i._stageWidth=i.$("stage").width();i._stageHeight=i.$("stage").height();return i._stageWidth&&i._stageHeight>50},success:function(){A.push(i);if(i._options.swipe){var s=i.$("images").width(i.getDataLength()*i._stageWidth);e.each(new Array(i.getDataLength()),function(t){var r=new n.Picture,o=i.getData(t);e(r.container).css({position:"absolute",top:0,left:i._stageWidth*t}).prepend(i._layers[t]=e(H.create("galleria-layer")).css({position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:2})[0]).appendTo(s);o.video&&B(r.container);i._controls.slides.push(r);var u=new n.Picture;u.isIframe=!0;e(u.container).attr("class","galleria-frame").css({position:"absolute",top:0,left:0,zIndex:4,background:"#000",display:"none"}).appendTo(r.container);i._controls.frames.push(u)});i.finger.setup()}H.show(i.get("counter"));i._options.carousel&&i._carousel.bindControls();if(i._options.autoplay){i.pause();typeof i._options.autoplay=="number"&&(i._playtime=i._options.autoplay);i._playing=!0}if(i._firstrun){i._options.autoplay&&i.trigger(n.PLAY);typeof i._options.show=="number"&&i.show(i._options.show);return}i._firstrun=!0;n.History&&n.History.change(function(e){isNaN(e)?t.history.go(-1):i.show(e,r,!0)});i.trigger(n.READY);n.theme.init.call(i,i._options);e.each(n.ready.callbacks,function(e,t){typeof t=="function"&&t.call(i,i._options)});i._options.extend.call(i,i._options);/^[0-9]{1,4}$/.test(p)&&n.History?i.show(p,r,!0):i._data[i._options.show]&&i.show(i._options.show);i._options.autoplay&&i.trigger(n.PLAY)},error:function(){n.raise("Stage width or height is too small to show the gallery. Traced measures: width:"+i._stageWidth+"px, height: "+i._stageHeight+"px.",!0)}})},load:function(t,r,i){var s=this,o=this._options;this._data=[];this._thumbnails=[];this.$("thumbnails").empty();if(typeof r=="function"){i=r;r=null}t=t||o.dataSource;r=r||o.dataSelector;i=i||o.dataConfig;e.isPlainObject(t)&&(t=[t]);if(e.isArray(t))this.validate(t)?this._data=t:n.raise("Load failed: JSON Array not valid.");else{r+=",.video,.iframe";e(t).find(r).each(function(t,n){n=e(n);var r={},o=n.parent(),u=o.attr("href"),a=o.attr("rel");u&&(n[0].nodeName=="IMG"||n.hasClass("video"))&&k(u)?r.video=u:u&&n.hasClass("iframe")?r.iframe=u:r.image=r.big=u;a&&(r.big=a);e.each("big title description link layer image".split(" "),function(e,t){n.data(t)&&(r[t]=n.data(t).toString())});r.big||(r.big=r.image);s._data.push(e.extend({title:n.attr("title")||"",thumb:n.attr("src"),image:n.attr("src"),big:n.attr("src"),description:n.attr("alt")||"",link:n.attr("longdesc"),original:n.get(0)},r,i(n)))})}typeof o.dataSort=="function"?u.sort.call(this._data,o.dataSort):o.dataSort=="random"&&this._data.sort(function(){return v.round(v.random())-.5});this.getDataLength()&&this._parseData(function(){this.trigger(n.DATA)});return this},_parseData:function(t){var n=this,i,s=!1,o=function(){var r=!0;e.each(n._data,function(e,t){if(t.loading){r=!1;return!1}});if(r&&!s){s=!0;t.call(n)}};e.each(this._data,function(t,s){i=n._data[t];"thumb"in s==0&&(i.thumb=s.image);s.big||(i.big=s.image);if("video"in s){var u=k(s.video);if(u){i.iframe=(new C(u.provider,u.id)).embed()+function(){if(typeof n._options[u.provider]=="object"){var t="?",r=[];e.each(n._options[u.provider],function(e,t){r.push(e+"="+t)});u.provider=="youtube"&&(r=["wmode=opaque"].concat(r));return t+r.join("&")}return""}();(!i.thumb||!i.image)&&e.each(["thumb","image"],function(e,t){if(t=="image"&&!n._options.videoPoster){i.image=r;return}var s=new C(u.provider,u.id);if(!i[t]){i.loading=!0;s.getMedia(t,function(e,t){return function(n){e[t]=n;t=="image"&&!e.big&&(e.big=e.image);delete e.loading;o()}}(i,t))}})}}});o();return this},destroy:function(){this.$("target").data("galleria",null);this.$("container").off("galleria");this.get("target").innerHTML=this._original.html;this.clearTimer();H.removeFromArray(O,this);H.removeFromArray(A,this);n._waiters.length&&e.each(n._waiters,function(e,n){n&&t.clearTimeout(n)});return this},splice:function(){var e=this,n=H.array(arguments);t.setTimeout(function(){u.splice.apply(e._data,n);e._parseData(function(){e._createThumbnails()})},2);return e},push:function(){var e=this,n=H.array(arguments);n.length==1&&n[0].constructor==Array&&(n=n[0]);t.setTimeout(function(){u.push.apply(e._data,n);e._parseData(function(){e._createThumbnails(n)})},2);return e},_getActive:function(){return this._controls.getActive()},validate:function(e){return!0},bind:function(e,t){e=T(e);this.$("container").on(e,this.proxy(t));return this},unbind:function(e){e=T(e);this.$("container").off(e);return this},trigger:function(t){t=typeof t=="object"?e.extend(t,{scope:this}):{type:T(t),scope:this};this.$("container").trigger(t);return this},addIdleState:function(e,t,n,r){this._idle.add.apply(this._idle,H.array(arguments));return this},removeIdleState:function(e){this._idle.remove.apply(this._idle,H.array(arguments));return this},enterIdleMode:function(){this._idle.hide();return this},exitIdleMode:function(){this._idle.showAll();return this},enterFullscreen:function(e){this._fullscreen.enter.apply(this,H.array(arguments));return this},exitFullscreen:function(e){this._fullscreen.exit.apply(this,H.array(arguments));return this},toggleFullscreen:function(e){this._fullscreen[this.isFullscreen()?"exit":"enter"].apply(this,H.array(arguments));return this},bindTooltip:function(e,t){this._tooltip.bind.apply(this._tooltip,H.array(arguments));return this},defineTooltip:function(e,t){this._tooltip.define.apply(this._tooltip,H.array(arguments));return this},refreshTooltip:function(e){this._tooltip.show.apply(this._tooltip,H.array(arguments));return this},openLightbox:function(){this._lightbox.show.apply(this._lightbox,H.array(arguments));return this},closeLightbox:function(){this._lightbox.hide.apply(this._lightbox,H.array(arguments));return this},hasVariation:function(t){return e.inArray(t,this._options.variation.split(/\s+/))>-1},getActiveImage:function(){var e=this._getActive();return e?e.image:r},getActiveThumb:function(){return this._thumbnails[this._active].image||r},getMousePosition:function(e){return{x:e.pageX-this.$("container").offset().left,y:e.pageY-this.$("container").offset().top}},addPan:function(t){if(this._options.imageCrop===!1)return;t=e(t||this.getActiveImage());var n=this,r=t.width()/2,i=t.height()/2,s=parseInt(t.css("left"),10),o=parseInt(t.css("top"),10),u=s||0,a=o||0,f=0,l=0,c=!1,h=H.timestamp(),p=0,d=0,m=function(e,n,r){if(e>0){d=v.round(v.max(e*-1,v.min(0,n)));if(p!==d){p=d;if(y===8)t.parent()["scroll"+r](d*-1);else{var i={};i[r.toLowerCase()]=d;t.css(i)}}}},g=function(e){if(H.timestamp()-h<50)return;c=!0;r=n.getMousePosition(e).x;i=n.getMousePosition(e).y},b=function(e){if(!c)return;f=t.width()-n._stageWidth;l=t.height()-n._stageHeight;s=r/n._stageWidth*f*-1;o=i/n._stageHeight*l*-1;u+=(s-u)/n._options.imagePanSmoothness;a+=(o-a)/n._options.imagePanSmoothness;m(l,a,"Top");m(f,u,"Left")};if(y===8){t.parent().scrollTop(a*-1).scrollLeft(u*-1);t.css({top:0,left:0})}this.$("stage").off("mousemove",g).on("mousemove",g);this.addTimer("pan"+n._id,b,50,!0);return this},proxy:function(e,t){if(typeof e!="function")return m;t=t||this;return function(){return e.apply(t,H.array(arguments))}},removePan:function(){this.$("stage").off("mousemove");this.clearTimer("pan"+this._id);return this},addElement:function(t){var n=this._dom;e.each(H.array(arguments),function(e,t){n[t]=H.create("galleria-"+t)});return this},attachKeyboard:function(e){this._keyboard.attach.apply(this._keyboard,H.array(arguments));return this},detachKeyboard:function(){this._keyboard.detach.apply(this._keyboard,H.array(arguments));return this},appendChild:function(e,t){this.$(e).append(this.get(t)||t);return this},prependChild:function(e,t){this.$(e).prepend(this.get(t)||t);return this},remove:function(e){this.$(H.array(arguments).join(",")).remove();return this},append:function(e){var t,n;for(t in e)if(e.hasOwnProperty(t))if(e[t].constructor===Array)for(n=0;e[t][n];n++)this.appendChild(t,e[t][n]);else this.appendChild(t,e[t]);return this},_scaleImage:function(t,n){t=t||this._controls.getActive();if(!t)return;var r,i=function(t){e(t.container).children(":first").css({top:v.max(0,H.parseValue(t.image.style.top)),left:v.max(0,H.parseValue(t.image.style.left)),width:H.parseValue(t.image.width),height:H.parseValue(t.image.height)})};n=e.extend({width:this._stageWidth,height:this._stageHeight,crop:this._options.imageCrop,max:this._options.maxScaleRatio,min:this._options.minScaleRatio,margin:this._options.imageMargin,position:this._options.imagePosition,iframelimit:this._options.maxVideoSize},n);if(this._options.layerFollow&&this._options.imageCrop!==!0)if(typeof n.complete=="function"){r=n.complete;n.complete=function(){r.call(t,t);i(t)}}else n.complete=i;else e(t.container).children(":first").css({top:0,left:0});t.scale(n);return this},updateCarousel:function(){this._carousel.update();return this},resize:function(t,n){if(typeof t=="function"){n=t;t=r}t=e.extend({width:0,height:0},t);var i=this,s=this.$("container");e.each(t,function(e,n){if(!n){s[e]("auto");t[e]=i._getWH()[e]}});e.each(t,function(e,t){s[e](t)});return this.rescale(n)},rescale:function(t,i,s){var o=this;if(typeof t=="function"){s=t;t=r}var u=function(){o._stageWidth=t||o.$("stage").width();o._stageHeight=i||o.$("stage").height();if(o._options.swipe){e.each(o._controls.slides,function(t,n){o._scaleImage(n);e(n.container).css("left",o._stageWidth*t)});o.$("images").css("width",o._stageWidth*o.getDataLength())}else o._scaleImage();o._options.carousel&&o.updateCarousel();o._controls.frames[o._controls.active].scale({width:o._stageWidth,height:o._stageHeight,iframelimit:o._options.maxVideoSize});o.trigger(n.RESCALE);typeof s=="function"&&s.call(o)};u.call(o);return this},refreshImage:function(){this._scaleImage();this._options.imagePan&&this.addPan();return this},_preload:function(){if(this._options.preload){var e,t,r=this.getNext(),i;try{for(t=this._options.preload;t>0;t--){e=new n.Picture;i=this.getData(r);e.preload(this.isFullscreen()&&i.big?i.big:i.image);r=this.getNext(r)}}catch(s){}}},show:function(r,i,s){var o=this._options.swipe;if(!o&&(this._queue.length>3||r===!1||!this._options.queue&&this._queue.stalled))return;r=v.max(0,v.min(parseInt(r,10),this.getDataLength()-1));i=typeof i!="undefined"?!!i:r<this.getIndex();s=s||!1;if(!s&&n.History){n.History.set(r.toString());return}if(this.finger&&r!==this._active){this.finger.to=-(r*this.finger.width);this.finger.index=r}this._active=r;if(o){var a=this.getData(r),f=this;if(!a)return;var l=this.isFullscreen()&&a.big?a.big:a.image||a.iframe,c=this._controls.slides[r],h=c.isCached(l),p=this._thumbnails[r],d={cached:h,index:r,rewind:i,imageTarget:c.image,thumbTarget:p.image,galleriaData:a};this.trigger(e.extend(d,{type:n.LOADSTART}));f.$("container").removeClass("videoplay");var m=function(){f._layers[r].innerHTML=f.getData().layer||"";f.trigger(e.extend(d,{type:n.LOADFINISH}));f._playCheck()};f._preload();t.setTimeout(function(){if(!c.ready||c.image.src!=l){a.iframe&&!a.image&&(c.isIframe=!0);c.load(l,function(t){f._scaleImage(t,m).trigger(e.extend(d,{type:n.IMAGE}));m()})}else{f.trigger(e.extend(d,{type:n.IMAGE}));m()}},100)}else{u.push.call(this._queue,{index:r,rewind:i});this._queue.stalled||this._show()}return this},_show:function(){var i=this,s=this._queue[0],o=this.getData(s.index);if(!o)return;var a=this.isFullscreen()&&o.big?o.big:o.image||o.iframe,f=this._controls.getActive(),l=this._controls.getNext(),c=l.isCached(a),h=this._thumbnails[s.index],p=function(){e(l.image).trigger("mouseup")};i.$("container").toggleClass("iframe",!!o.isIframe).removeClass("videoplay");var d=function(s,o,a,f,l){return function(){var c;j.active=!1;H.toggleQuality(o.image,i._options.imageQuality);i._layers[i._controls.active].innerHTML="";e(a.container).css({zIndex:0,opacity:0}).show();e(a.container).find("iframe, .galleria-videoicon").remove();e(i._controls.frames[i._controls.active].container).hide();e(o.container).css({zIndex:1,left:0,top:0}).show();i._controls.swap();i._options.imagePan&&i.addPan(o.image);(s.iframe&&s.image||s.link||i._options.lightbox||i._options.clicknext)&&e(o.image).css({cursor:"pointer"}).on("mouseup",function(o){if(typeof o.which=="number"&&o.which>1)return;if(s.iframe){i.isPlaying()&&i.pause();var u=i._controls.frames[i._controls.active],a=i._stageWidth,f=i._stageHeight;e(u.container).css({width:a,height:f,opacity:0}).show().animate({opacity:1},200);t.setTimeout(function(){u.load(s.iframe+(s.video?"&autoplay=1":""),{width:a,height:f},function(e){i.$("container").addClass("videoplay");e.scale({width:i._stageWidth,height:i._stageHeight,iframelimit:s.video?i._options.maxVideoSize:r})})},100);return}if(i._options.clicknext&&!n.TOUCH){i._options.pauseOnInteraction&&i.pause();i.next();return}if(s.link){i._options.popupLinks?c=t.open(s.link,"_blank"):t.location.href=s.link;return}i._options.lightbox&&i.openLightbox()});i._playCheck();i.trigger({type:n.IMAGE,index:f.index,imageTarget:o.image,thumbTarget:l.image,galleriaData:s});u.shift.call(i._queue);i._queue.stalled=!1;i._queue.length&&i._show()}}(o,l,f,s,h);this._options.carousel&&this._options.carouselFollow&&this._carousel.follow(s.index);i._preload();H.show(l.container);l.isIframe=o.iframe&&!o.image;e(i._thumbnails[s.index].container).addClass("active").siblings(".active").removeClass("active");i.trigger({type:n.LOADSTART,cached:c,index:s.index,rewind:s.rewind,imageTarget:l.image,thumbTarget:h.image,galleriaData:o});i._queue.stalled=!0;l.load(a,function(t){var u=e(i._layers[1-i._controls.active]).html(o.layer||"").hide();i._scaleImage(t,{complete:function(t){"image"in f&&H.toggleQuality(f.image,!1);H.toggleQuality(t.image,!1);i.removePan();i.setInfo(s.index);i.setCounter(s.index);if(o.layer){u.show();(o.iframe&&o.image||o.link||i._options.lightbox||i._options.clicknext)&&u.css("cursor","pointer").off("mouseup").mouseup(p)}o.video&&o.image&&B(t.container);var a=i._options.transition;e.each({initial:f.image===null,touch:n.TOUCH,fullscreen:i.isFullscreen()},function(e,t){if(t&&i._options[e+"Transition"]!==r){a=i._options[e+"Transition"];return!1}});if(a in j.effects==0)d();else{var l={prev:f.container,next:t.container,rewind:s.rewind,speed:i._options.transitionSpeed||400};j.active=!0;j.init.call(i,a,l,d)}i.trigger({type:n.LOADFINISH,cached:c,index:s.index,rewind:s.rewind,imageTarget:t.image,thumbTarget:i._thumbnails[s.index].image,galleriaData:i.getData(s.index)})}})})},getNext:function(e){e=typeof e=="number"?e:this.getIndex();return e===this.getDataLength()-1?0:e+1},getPrev:function(e){e=typeof e=="number"?e:this.getIndex();return e===0?this.getDataLength()-1:e-1},next:function(){this.getDataLength()>1&&this.show(this.getNext(),!1);return this},prev:function(){this.getDataLength()>1&&this.show(this.getPrev(),!0);return this},get:function(e){return e in this._dom?this._dom[e]:null},getData:function(e){return e in this._data?this._data[e]:this._data[this._active]},getDataLength:function(){return this._data.length},getIndex:function(){return typeof this._active=="number"?this._active:!1},getStageHeight:function(){return this._stageHeight},getStageWidth:function(){return this._stageWidth},getOptions:function(e){return typeof e=="undefined"?this._options:this._options[e]},setOptions:function(t,n){typeof t=="object"?e.extend(this._options,t):this._options[t]=n;return this},play:function(e){this._playing=!0;this._playtime=e||this._playtime;this._playCheck();this.trigger(n.PLAY);return this},pause:function(){this._playing=!1;this.trigger(n.PAUSE);return this},playToggle:function(e){return this._playing?this.pause():this.play(e)},isPlaying:function(){return this._playing},isFullscreen:function(){return this._fullscreen.active},_playCheck:function(){var e=this,t=0,r=20,i=H.timestamp(),s="play"+this._id;if(this._playing){this.clearTimer(s);var o=function(){t=H.timestamp()-i;if(t>=e._playtime&&e._playing){e.clearTimer(s);e.next();return}if(e._playing){e.trigger({type:n.PROGRESS,percent:v.ceil(t/e._playtime*100),seconds:v.floor(t/1e3),milliseconds:t});e.addTimer(s,o,r)}};e.addTimer(s,o,r)}},setPlaytime:function(e){this._playtime=e;return this},setIndex:function(e){this._active=e;return this},setCounter:function(e){typeof e=="number"?e++:typeof e=="undefined"&&(e=this.getIndex()+1);this.get("current").innerHTML=e;if(y){var t=this.$("counter"),n=t.css("opacity");parseInt(n,10)===1?H.removeAlpha(t[0]):this.$("counter").css("opacity",n)}return this},setInfo:function(t){var n=this,r=this.getData(t);e.each(["title","description"],function(e,t){var i=n.$("info-"+t);r[t]?i[r[t].length?"show":"hide"]().html(r[t]):i.empty().hide()});return this},hasInfo:function(e){var t="title description".split(" "),n;for(n=0;t[n];n++)if(!!this.getData(e)[t[n]])return!0;return!1},jQuery:function(t){var n=this,r=[];e.each(t.split(","),function(t,i){i=e.trim(i);n.get(i)&&r.push(i)});var i=e(n.get(r.shift()));e.each(r,function(e,t){i=i.add(n.get(t))});return i},$:function(e){return this.jQuery.apply(this,H.array(arguments))}};e.each(S,function(e,t){var r=/_/.test(t)?t.replace(/_/g,""):t;n[t.toUpperCase()]="galleria."+r});e.extend(n,{IE9:y===9,IE8:y===8,IE7:y===7,IE6:y===6,IE:y,WEBKIT:/webkit/.test(h),CHROME:/chrome/.test(h),SAFARI:/safari/.test(h)&&!/chrome/.test(h),QUIRK:y&&i.compatMode&&i.compatMode==="BackCompat",MAC:/mac/.test(navigator.platform.toLowerCase()),OPERA:!!t.opera,IPHONE:/iphone/.test(h),IPAD:/ipad/.test(h),ANDROID:/android/.test(h),TOUCH:"ontouchstart"in i});n.addTheme=function(r){r.name||n.raise("No theme name specified");typeof r.defaults!="object"?r.defaults={}:r.defaults=x(r.defaults);var i=!1,s;if(typeof r.css=="string"){e("link").each(function(e,t){s=new RegExp(r.css);if(s.test(t.href)){i=!0;P(r);return!1}});i||e(function(){var o=0,u=function(){e("script").each(function(e,n){s=new RegExp("galleria\\."+r.name.toLowerCase()+"\\.");if(s.test(n.src)){i=n.src.replace(/[^\/]*$/,"")+r.css;t.setTimeout(function(){H.loadCSS(i,"galleria-theme",function(){P(r)})},1)}});i||(o++>5?n.raise("No theme CSS loaded"):t.setTimeout(u,500))};u()})}else P(r);return r};n.loadTheme=function(r,i){if(e("script").filter(function(){return e(this).attr("src")==r}).length)return;var s=!1,o;e(t).load(function(){s||(o=t.setTimeout(function(){!s&&!n.theme&&n.raise("Galleria had problems loading theme at "+r+". Please check theme path or load manually.",!0)},2e4))});n.unloadTheme();H.loadScript(r,function(){s=!0;t.clearTimeout(o)});return n};n.unloadTheme=function(){if(typeof n.theme=="object"){e("script").each(function(t,r){(new RegExp("galleria\\."+n.theme.name+"\\.")).test(r.src)&&e(r).remove()});n.theme=r}return n};n.get=function(e){if(!!O[e])return O[e];if(typeof e!="number")return O;n.raise("Gallery index "+e+" not found")};n.configure=function(t,r){var i={};if(typeof t=="string"&&r){i[t]=r;t=i}else e.extend(i,t);n.configure.options=i;e.each(n.get(),function(e,t){t.setOptions(i)});return n};n.configure.options={};n.on=function(t,r){if(!t)return;r=r||m;var i=t+r.toString().replace(/\s/g,"")+H.timestamp();e.each(n.get(),function(e,n){n._binds.push(i);n.bind(t,r)});n.on.binds.push({type:t,callback:r,hash:i});return n};n.on.binds=[];n.run=function(t,r){e.isFunction(r)&&(r={extend:r});e(t||"#galleria").galleria(r);return n};n.addTransition=function(e,t){j.effects[e]=t;return n};n.utils=H;n.log=function(){var n=H.array(arguments);if(!("console"in t&&"log"in t.console))return t.alert(n.join("<br>"));try{return t.console.log.apply(t.console,n)}catch(r){e.each(n,function(){t.console.log(this)})}};n.ready=function(t){if(typeof t!="function")return n;e.each(A,function(e,n){t.call(n,n._options)});n.ready.callbacks.push(t);return n};n.ready.callbacks=[];n.raise=function(t,n){var r=n?"Fatal error":"Error",i={color:"#fff",position:"absolute",top:0,left:0,zIndex:1e5},s=function(t){var s='<div style="padding:4px;margin:0 0 2px;background:#'+(n?"811":"222")+';">'+(n?"<strong>"+r+": </strong>":"")+t+"</div>";e.each(O,function(){var e=this.$("errors"),t=this.$("target");if(!e.length){t.css("position","relative");e=this.addElement("errors").appendChild("target","errors").$("errors").css(i)}e.append(s)});O.length||e("<div>").css(e.extend(i,{position:"fixed"})).append(s).appendTo(b().body)};if(f){s(t);if(n)throw new Error(r+": "+t)}else if(n){if(M)return;M=!0;n=!1;s("Gallery could not load.")}};n.version=a;n.requires=function(e,t){t=t||"You need to upgrade Galleria to version "+e+" to use one or more components.";n.version<e&&n.raise(t,!0);return n};n.Picture=function(t){this.id=t||null;this.image=null;this.container=H.create("galleria-image");e(this.container).css({overflow:"hidden",position:"relative"});this.original={width:0,height:0};this.ready=!1;this.isIframe=!1};n.Picture.prototype={cache:{},show:function(){H.show(this.image)},hide:function(){H.moveOut(this.image)},clear:function(){this.image=null},isCached:function(e){return!!this.cache[e]},preload:function(t){e(new Image).load(function(e,t){return function(){t[e]=e}}(t,this.cache)).attr("src",t)},load:function(r,i,s){if(typeof i=="function"){s=i;i=null}if(this.isIframe){var o="if"+(new Date).getTime(),u=this.image=e("<iframe>",{src:r,frameborder:0,id:o,allowfullscreen:!0,css:{visibility:"hidden"}})[0];i&&e(u).css(i);e(this.container).find("iframe,img").remove();this.container.appendChild(this.image);e("#"+o).load(function(n,r){return function(){t.setTimeout(function(){e(n.image).css("visibility","visible");typeof r=="function"&&r.call(n,n)},10)}}(this,s));return this.container}this.image=new Image;n.IE8&&e(this.image).css("filter","inherit");var a=!1,f=!1,l=e(this.container),h=e(this.image),p=function(){if(!a){a=!0;t.setTimeout(function(e,t){return function(){e.attr("src",t+(t.indexOf("?")>-1?"&":"?")+H.timestamp())}}(e(this),r),50)}else c?e(this).attr("src",c):n.raise("Image not found: "+r)},d=function(r,s,o){return function(){var u=function(){e(this).off("load");r.original=i||{height:this.height,width:this.width};n.HAS3D&&(this.style.MozTransform=this.style.webkitTransform="translate3d(0,0,0)");l.append(this);r.cache[o]=o;typeof s=="function"&&t.setTimeout(function(){s.call(r,r)},1)};!this.width||!this.height?function(t){H.wait({until:function(){return t.width&&t.height},success:function(){u.call(t)},error:function(){if(!f){e(new Image).load(d).attr("src",t.src);f=!0}else n.raise("Could not extract width/height from image: "+t.src+". Traced measures: width:"+t.width+"px, height: "+t.height+"px.")},timeout:100})}(this):u.call(this)}}(this,s,r);l.find("iframe,img").remove();h.css("display","block");H.hide(this.image);e.each("minWidth minHeight maxWidth maxHeight".split(" "),function(e,t){h.css(t,/min/.test(t)?"0":"none")});h.load(d).on("error",p).attr("src",r);return this.container},scale:function(t){var i=this;t=e.extend({width:0,height:0,min:r,max:r,margin:0,complete:m,position:"center",crop:!1,canvas:!1,iframelimit:r},t);if(this.isIframe){var s=t.width,o=t.height,u,a;if(t.iframelimit
){var f=v.min(t.iframelimit/s,t.iframelimit/o);if(f<1){u=s*f;a=o*f;e(this.image).css({top:o/2-a/2,left:s/2-u/2,position:"absolute"})}else e(this.image).css({top:0,left:0})}e(this.image).width(u||s).height(a||o).removeAttr("width").removeAttr("height");e(this.container).width(s).height(o);t.complete.call(i,i);try{this.image.contentWindow&&e(this.image.contentWindow).trigger("resize")}catch(l){}return this.container}if(!this.image)return this.container;var c,h,p=e(i.container),d;H.wait({until:function(){c=t.width||p.width()||H.parseValue(p.css("width"));h=t.height||p.height()||H.parseValue(p.css("height"));return c&&h},success:function(){var n=(c-t.margin*2)/i.original.width,r=(h-t.margin*2)/i.original.height,s=v.min(n,r),o=v.max(n,r),u={"true":o,width:n,height:r,"false":s,landscape:i.original.width>i.original.height?o:s,portrait:i.original.width<i.original.height?o:s},a=u[t.crop.toString()],f="";t.max&&(a=v.min(t.max,a));t.min&&(a=v.max(t.min,a));e.each(["width","height"],function(t,n){e(i.image)[n](i[n]=i.image[n]=v.round(i.original[n]*a))});e(i.container).width(c).height(h);if(t.canvas&&_){_.elem.width=i.width;_.elem.height=i.height;f=i.image.src+":"+i.width+"x"+i.height;i.image.src=_.cache[f]||function(e){_.context.drawImage(i.image,0,0,i.original.width*a,i.original.height*a);try{d=_.elem.toDataURL();_.length+=d.length;_.cache[e]=d;return d}catch(t){return i.image.src}}(f)}var l={},p={},m=function(t,n,r){var s=0;if(/\%/.test(t)){var o=parseInt(t,10)/100,u=i.image[n]||e(i.image)[n]();s=v.ceil(u*-1*o+r*o)}else s=H.parseValue(t);return s},g={top:{top:0},left:{left:0},right:{left:"100%"},bottom:{top:"100%"}};e.each(t.position.toLowerCase().split(" "),function(e,t){t==="center"&&(t="50%");l[e?"top":"left"]=t});e.each(l,function(t,n){g.hasOwnProperty(n)&&e.extend(p,g[n])});l=l.top?e.extend(l,p):p;l=e.extend({top:"50%",left:"50%"},l);e(i.image).css({position:"absolute",top:m(l.top,"height",h),left:m(l.left,"width",c)});i.show();i.ready=!0;t.complete.call(i,i)},error:function(){n.raise("Could not scale image: "+i.image.src)},timeout:1e3});return this}};e.extend(e.easing,{galleria:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t+n:r/2*((t-=2)*t*t+2)+n},galleriaIn:function(e,t,n,r,i){return r*(t/=i)*t+n},galleriaOut:function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n}});n.Finger=function(){var r=v.abs,o=n.HAS3D=function(){var t=i.createElement("p"),n,r=["webkit","O","ms","Moz",""],s,o=0,u="transform";b().html.insertBefore(t,null);for(;r[o];o++){s=r[o]?r[o]+"Transform":u;if(t.style[s]!==undefined){t.style[s]="translate3d(1px,1px,1px)";n=e(t).css(r[o]?"-"+r[o].toLowerCase()+"-"+u:u)}}b().html.removeChild(t);return n!==undefined&&n.length>0&&n!=="none"}(),u=function(){var e="RequestAnimationFrame";return t.requestAnimationFrame||t["webkit"+e]||t["moz"+e]||t["o"+e]||t["ms"+e]||function(e){t.setTimeout(e,1e3/60)}}(),a=function(n,r){this.config={start:0,duration:500,onchange:function(){},oncomplete:function(){},easing:function(e,t,n,r,i){return-r*((t=t/i-1)*t*t*t-1)+n}};this.easeout=function(e,t,n,r,i){return r*((t=t/i-1)*t*t*t*t+1)+n};if(!n.children.length)return;var i=this;e.extend(this.config,r);this.elem=n;this.child=n.children[0];this.to=this.pos=0;this.touching=!1;this.start={};this.index=this.config.start;this.anim=0;this.easing=this.config.easing;if(!o){this.child.style.position="absolute";this.elem.style.position="relative"}e.each(["ontouchstart","ontouchmove","ontouchend","setup"],function(e,t){i[t]=function(e){return function(){e.apply(i,arguments)}}(i[t])});this.setX=function(){var e=i.child.style;if(!o){e.left=i.pos+"px";return}e.MozTransform=e.webkitTransform="translate3d("+i.pos+"px,0,0)";return};e(n).on("touchstart",this.ontouchstart);e(t).on("resize",this.setup);e(t).on("orientationchange",this.setup);this.setup();(function s(){u(s);i.loop.call(i)})()};a.prototype={constructor:a,setup:function(){this.width=e(this.elem).width();this.length=v.ceil(e(this.child).width()/this.width);if(this.index!==0){this.index=v.max(0,v.min(this.index,this.length-1));this.pos=this.to=-this.width*this.index}},setPosition:function(e){this.pos=e;this.to=e},ontouchstart:function(e){var t=e.originalEvent.touches;this.start={pageX:t[0].pageX,pageY:t[0].pageY,time:+(new Date)};this.isScrolling=null;this.touching=!0;this.deltaX=0;s.on("touchmove",this.ontouchmove);s.on("touchend",this.ontouchend)},ontouchmove:function(e){var t=e.originalEvent.touches;if(t&&t.length>1||e.scale&&e.scale!==1)return;this.deltaX=t[0].pageX-this.start.pageX;this.isScrolling===null&&(this.isScrolling=!!(this.isScrolling||v.abs(this.deltaX)<v.abs(t[0].pageY-this.start.pageY)));if(!this.isScrolling){e.preventDefault();this.deltaX/=!this.index&&this.deltaX>0||this.index==this.length-1&&this.deltaX<0?v.abs(this.deltaX)/this.width+1.8:1;this.to=this.deltaX-this.index*this.width}e.stopPropagation()},ontouchend:function(e){this.touching=!1;var t=+(new Date)-this.start.time<250&&v.abs(this.deltaX)>40||v.abs(this.deltaX)>this.width/2,n=!this.index&&this.deltaX>0||this.index==this.length-1&&this.deltaX<0;this.isScrolling||this.show(this.index+(t&&!n?this.deltaX<0?1:-1:0));s.off("touchmove",this.ontouchmove);s.off("touchend",this.ontouchend)},show:function(e){e!=this.index?this.config.onchange.call(this,e):this.to=-(e*this.width)},moveTo:function(e){if(e!=this.index){this.pos=this.to=-(e*this.width);this.index=e}},loop:function(){var e=this.to-this.pos,t=1;this.width&&e&&(t=v.max(.5,v.min(1.5,v.abs(e/this.width))));if(this.touching||v.abs(e)<=1){this.pos=this.to;e=0;this.anim&&!this.touching&&this.config.oncomplete(this.index);this.anim=0;this.easing=this.config.easing}else{this.anim||(this.anim={start:this.pos,time:+(new Date),distance:e,factor:t,destination:this.to});var n=+(new Date)-this.anim.time,r=this.config.duration*this.anim.factor;if(n>r||this.anim.destination!=this.to){this.anim=0;this.easing=this.easeout;return}this.pos=this.easing(null,n,this.anim.start,this.anim.distance,r)}this.setX()}};return a}();e.fn.galleria=function(t){var r=this.selector;if(!e(this).length){e(function(){e(r).length?e(r).galleria(t):n.utils.wait({until:function(){return e(r).length},success:function(){e(r).galleria(t)},error:function(){n.raise('Init failed: Galleria could not find the element "'+r+'".')},timeout:5e3})});return this}return this.each(function(){if(e.data(this,"galleria")){e.data(this,"galleria").destroy();e(this).find("*").hide()}e.data(this,"galleria",(new n).init(this,t))})};if(typeof module=="object"&&module&&typeof module.exports=="object")module.exports=n;else{t.Galleria=n;typeof define=="function"&&define.amd&&define("galleria",["jquery"],function(){return n})}})(jQuery,this);
